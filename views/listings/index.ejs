<% layout('layouts/boilerplate') %>

<body>
    <!-- <h3>All Listings</h3> -->

<!-- creating create route on main index.ejs page for to create new listings   -->
     <!-- <form method ="GET" action="/listings/new">
    <button>Create New Listing</button>
    </form> -->

    <div class="main-content">
        <!-- Sidebar Filters -->
        <aside class="filters-sidebar" role="complementary" aria-label="Filter sidebar">
            <div class="sidebar-header">
                <h3><i class="fa-solid fa-filter me-2"></i>Filters</h3>
                <div class="sidebar-controls">
                    <button class="sidebar-toggle d-lg-none" id="sidebarToggle" aria-label="Close sidebar">
                        <i class="fa-solid fa-times"></i>
                    </button>
                    <button class="desktop-sidebar-toggle d-none d-lg-block" id="desktopSidebarToggle" title="Toggle Filters Sidebar" aria-label="Toggle Filters Sidebar">
                        <i class="fa-solid fa-angles-left" id="sidebarIcon"></i>
                        <span id="toggleText">Hide Filters</span>
                    </button>
                </div>
            </div>
            
            <div class="filters-container">
                <button class="btn btn-outline-secondary w-100 mb-3" id="clearFiltersBtn" type="button">
                    <i class="fa fa-times me-2"></i>Clear Filters
                </button>
                <div class="filter-group">
                    <h4 class="filter-group-title">Categories</h4>
                    <div class="filter" data-filter="all">
                        <input type="checkbox" class="form-check-input filter-checkbox" id="filter-all" data-filter="all" checked>
                        <label for="filter-all"><i class="fa-solid fa-list"></i> All Properties</label>
                        <div class="filter-indicator"></div>
                    </div>
                    <div class="filter" data-filter="trending">
                        <input type="checkbox" class="form-check-input filter-checkbox" id="filter-trending" data-filter="trending">
                        <label for="filter-trending"><i class="fa-solid fa-fire"></i> Trending</label>
                        <div class="filter-indicator"></div>
                    </div>
                    <div class="filter" data-filter="toprated">
                        <input type="checkbox" class="form-check-input filter-checkbox" id="filter-toprated" data-filter="toprated">
                        <label for="filter-toprated"><i class="fa-solid fa-star"></i> Top Rated</label>
                        <div class="filter-indicator"></div>
                    </div>
                </div>
                
                <div class="filter-group">
                    <h4 class="filter-group-title">Location Type</h4>
                    <div class="filter" data-filter="mountain">
                        <input type="checkbox" class="form-check-input filter-checkbox" id="filter-mountain" data-filter="mountain">
                        <label for="filter-mountain"><i class="fa-solid fa-mountain"></i> Mountains</label>
                        <div class="filter-indicator"></div>
                    </div>
                    <div class="filter" data-filter="beach">
                        <input type="checkbox" class="form-check-input filter-checkbox" id="filter-beach" data-filter="beach">
                        <label for="filter-beach"><i class="fa-solid fa-umbrella-beach"></i> Beach</label>
                        <div class="filter-indicator"></div>
                    </div>
                    <div class="filter" data-filter="city">
                        <input type="checkbox" class="form-check-input filter-checkbox" id="filter-city" data-filter="city">
                        <label for="filter-city"><i class="fa-solid fa-city"></i> City</label>
                        <div class="filter-indicator"></div>
                    </div>
                </div>
                
                <div class="filter-group">
                    <h4 class="filter-group-title">Property Type</h4>
                    <div class="filter" data-filter="villa">
                        <input type="checkbox" class="form-check-input filter-checkbox" id="filter-villa" data-filter="villa">
                        <label for="filter-villa"><i class="fa-solid fa-house-chimney"></i> Villas</label>
                        <div class="filter-indicator"></div>
                    </div>
                    <div class="filter" data-filter="apartment">
                        <input type="checkbox" class="form-check-input filter-checkbox" id="filter-apartment" data-filter="apartment">
                        <label for="filter-apartment"><i class="fa-solid fa-building"></i> Apartments</label>
                        <div class="filter-indicator"></div>
                    </div>
                </div>
                
                <div class="filter-group">
                    <h4 class="filter-group-title">Price Range</h4>
                    <div class="filter" data-filter="budget">
                        <input type="checkbox" class="form-check-input filter-checkbox" id="filter-budget" data-filter="budget">
                        <label for="filter-budget"><i class="fa-solid fa-coins"></i> Budget Friendly</label>
                        <div class="filter-indicator"></div>
                    </div>
                    <div class="filter" data-filter="luxury">
                        <input type="checkbox" class="form-check-input filter-checkbox" id="filter-luxury" data-filter="luxury">
                        <label for="filter-luxury"><i class="fa-solid fa-crown"></i> Luxury</label>
                        <div class="filter-indicator"></div>
                    </div>
                </div>
                
                <div class="filter-group">
                    <div class="tax-toggle">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" role="switch" id="switchCheckDefault">
                            <label class="form-check-label" for="switchCheckDefault">
                                <i class="fa-solid fa-calculator me-2"></i>Include taxes
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
        
        <!-- Toggle Button for Mobile -->
        <button class="mobile-filter-toggle d-lg-none" id="mobileFilterToggle">
            <i class="fa-solid fa-filter me-2"></i>Filters
        </button>
        
        <!-- Main Content Area -->
        <main class="content-area" role="main" aria-label="Listings content">
            
            <!-- Enhanced Results Section -->
            <div class="listings-results-section">
                <% if (allListings.length === 0) { %>
                    <div class="empty-state">
                        <% if (searchQuery) { %>
                            <div class="no-results-container">
                                <div class="no-results-icon">
                                    <i class="fas fa-search-location"></i>
                                </div>
                                <h3 class="no-results-title">No listings found</h3>
                                <p class="no-results-subtitle">We couldn't find any listings matching "<%= searchQuery %>"</p>
                                
                                <div class="suggested-searches">
                                    <h6>Try these popular destinations:</h6>
                                    <div class="suggestion-tags">
                                        <a href="/listings?search=mountain" class="suggestion-tag mountain">
                                            <i class="fas fa-mountain"></i>
                                            Mountain
                                        </a>
                                        <a href="/listings?search=beach" class="suggestion-tag beach">
                                            <i class="fas fa-umbrella-beach"></i>
                                            Beach
                                        </a>
                                        <a href="/listings?search=city" class="suggestion-tag city">
                                            <i class="fas fa-city"></i>
                                            City
                                        </a>
                                        <a href="/listings?search=forest" class="suggestion-tag forest">
                                            <i class="fas fa-tree"></i>
                                            Forest
                                        </a>
                                        <a href="/listings?search=lake" class="suggestion-tag lake">
                                            <i class="fas fa-water"></i>
                                            Lake
                                        </a>
                                    </div>
                                </div>
                                
                                <a href="/listings" class="btn btn-primary view-all-btn">
                                    <i class="fas fa-list me-2"></i>
                                    View All Listings
                                </a>
                            </div>
                        <% } else { %>
                            <div class="no-listings-container">
                                <div class="no-listings-icon">
                                    <i class="fas fa-home"></i>
                                </div>
                                <h3 class="no-listings-title">No listings available</h3>
                                <p class="no-listings-subtitle">Be the first to create a listing!</p>
                                <a href="/listings/new" class="btn btn-primary create-first-btn">
                                    <i class="fas fa-plus-circle me-2"></i>
                                    Create First Listing
                                </a>
                            </div>
                        <% } %>
                    </div>
                <% } else { %>
                    <!-- Search Results Header -->
                    <% if (searchQuery) { %>
                        <div class="search-results-banner">
                            <div class="search-results-info">
                                <h4 class="results-title">
                                    <i class="fas fa-search me-2"></i>
                                    Search Results for "<%= searchQuery %>"
                                </h4>
                                <p class="results-count">
                                    <i class="fas fa-home me-1"></i>
                                    <%= allListings.length %> listing<%= allListings.length !== 1 ? 's' : '' %> found
                                </p>
                            </div>
                            
                            <div class="search-actions">
                                <a href="/listings" class="btn btn-outline-primary clear-search-btn">
                                    <i class="fas fa-times me-2"></i>
                                    Clear Search
                                </a>
                            </div>
                        </div>
                        
                        <% if (searchHistory && searchHistory.length > 0) { %>
                            <div class="related-searches">
                                <span class="related-label">Related searches:</span>
                                <div class="related-pills">
                                    <% searchHistory.forEach(function(suggestion) { %>
                                        <a href="/listings?search=<%= encodeURIComponent(suggestion) %>" 
                                           class="related-pill">
                                            <%= suggestion %>
                                        </a>
                                    <% }); %>
                                </div>
                            </div>
                        <% } %>
                    <% } else { %>
                        <!-- All Listings Header -->
                        
                    <% } %>
                    
                    <!-- Listings Grid -->
                    <div class="row g-4">
                        <% for(let listing of allListings) { %>
                            <div class="col-lg-4 col-md-6 col-sm-12 mb-4 h-100">
                                <article class="listing-card-wrapper h-100">
                                    <a href="/listings/<%= listing._id %>" class="listing-card-link">
                                        <div class="enhanced-card h-100">
                                            <!-- Image Section -->
                                            <div class="card-image-container">
                                                <img 
                                                    src="<%= listing.image.url %>" 
                                                    class="card-image" 
                                                    alt="<%= listing.title %>" 
                                                    loading="lazy"
                                                    onerror="this.onerror=null; this.src='data:image/svg+xml,<svg xmlns=\'http://www.w3.org/2000/svg\' width=\'400\' height=\'300\' viewBox=\'0 0 400 300\'><defs><linearGradient id=\'grad\' x1=\'0%\' y1=\'0%\' x2=\'100%\' y2=\'100%\'><stop offset=\'0%\' stop-color=\'%23f8fafc\'/><stop offset=\'100%\' stop-color=\'%23e2e8f0\'/></linearGradient></defs><rect width=\'400\' height=\'300\' fill=\'url(%23grad)\'/><circle cx=\'200\' cy=\'150\' r=\'40\' fill=\'%23cbd5e1\'/><text x=\'200\' y=\'200\' text-anchor=\'middle\' fill=\'%236b7280\' font-family=\'Inter, sans-serif\' font-size=\'14\' font-weight=\'500\'>No Image Available</text></svg>';">
                                                
                                                <!-- Favorite Button -->
                                                <button class="favorite-btn" onclick="event.preventDefault(); toggleFavorite('<%= listing._id %>')" aria-label="Add to favorites" aria-pressed="false">
                                                    <i class="far fa-heart"></i>
                                                </button>
                                                
                                                <!-- Property Type Badge -->
                                                <div class="property-type-badge">
                                                    <i class="fas fa-home"></i>
                                                    <span>Property</span>
                                                </div>
                                                
                                                <!-- Image Overlay -->
                                                <div class="image-overlay">
                                                    <div class="overlay-content">
                                                        <i class="fas fa-eye"></i>
                                                        <span>View Details</span>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Card Content -->
                                            <div class="card-content">
                                                <!-- Title and Rating -->
                                                <div class="card-header-section">
                                                    <h3 class="listing-title"><%=listing.title%></h3>
                                                    <div class="rating-section">
                                                        <div class="rating-stars">
                                                            <i class="fas fa-star"></i>
                                                            <i class="fas fa-star"></i>
                                                            <i class="fas fa-star"></i>
                                                            <i class="fas fa-star"></i>
                                                            <i class="fas fa-star-half-alt"></i>
                                                        </div>
                                                        <span class="rating-text">4.8</span>
                                                    </div>
                                                </div>
                                                
                                                <!-- Description -->
                                                <p class="listing-description">
                                                    <%= listing.description.length > 120 ? listing.description.substring(0, 120) + '...' : listing.description %>
                                                </p>
                                                
                                                <!-- Location -->
                                                <div class="location-section">
                                                    <i class="fas fa-map-marker-alt location-icon"></i>
                                                    <span class="location-text"><%= listing.location %>, <%= listing.country %></span>
                                                </div>
                                                
                                                <!-- Price and Amenities -->
                                                <div class="price-amenities-section">
                                                    <div class="price-section">
                                                        <span class="price-amount">â‚¹<%= listing.price.toLocaleString("en-IN") %></span>
                                                        <span class="price-period">/night</span>
                                                        <span class="tax-info">+10% GST</span>
                                                    </div>
                                                    
                                                    <div class="amenities-preview">
                                                        <div class="amenity-item">
                                                            <i class="fas fa-wifi"></i>
                                                        </div>
                                                        <div class="amenity-item">
                                                            <i class="fas fa-car"></i>
                                                        </div>
                                                        <div class="amenity-item">
                                                            <i class="fas fa-swimming-pool"></i>
                                                        </div>
                                                        <span class="amenities-more">+5 more</span>
                                                    </div>
                                                </div>
                                                
                                                <!-- Footer Section -->
                                                <div class="card-footer-section">
                                                    <div class="availability-status">
                                                        <div class="status-indicator available"></div>
                                                        <span>Available</span>
                                                    </div>
                                                    
                                                    <div class="review-count">
                                                        <i class="fas fa-comment"></i>
                                                        <span>24 reviews</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </a>
                                </article>
                            </div>
                        <% } %>
                    </div>
                <% } %>
            </div>
        </main>
    </div>
</body>

<script>
    let taxSwitch =document.getElementById("switchCheckDefault");
    taxSwitch.addEventListener("click",()=>{
   let taxInfo=document.getElementsByClassName("tax-info");
   for (let info of taxInfo) {
        if (taxSwitch.checked) {
            info.style.display = "inline";
        } else {
            info.style.display = "none";
        }
   }
    })
</script>