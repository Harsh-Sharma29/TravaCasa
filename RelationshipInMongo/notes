# Relationships in MongoDB

MongoDB is a NoSQL, document-oriented database. Unlike relational databases, MongoDB does not enforce relationships using foreign keys. However, relationships between data can still be represented in two main ways:

## 1. Embedded Documents (Denormalization)

- Data is stored within a single document.
- Suitable for "contains" relationships or when related data is accessed together.
- Example: An order document contains an array of product documents.

### One-to-Few Relationships

- When a document contains a small number of related items, embedding is efficient.
- Example: A blog post document with a few comments embedded as an array.

### Pros

- Faster read operations since related data is stored together.
- Simpler queries.

### Cons

- Document size is limited (16MB in MongoDB).
- Updates to embedded arrays can be more complex if the array grows large.

## 2. References (Normalization)

- Data is split across multiple documents, and relationships are represented by storing references (usually ObjectIds).
- Suitable for "many" relationships or when related data is accessed independently.
- Example: An order document contains an array of product IDs referencing separate product documents.

### One-to-Many and Many-to-Many Relationships

- Use references when the "many" side can grow large or is shared across documents.
- Example: Users and roles, students and courses.

### Pros

- Avoids document size limits.
- Related data can be updated independently.

### Cons

- Requires additional queries (or `$lookup` aggregation) to join related data.
- Slightly more complex queries and data management.


read mongo db documentation on 6 thumbs on mongodb 


# Notes on Handling Deletion

handling deletion isliye use krte hai hum jb jese koi account dlete ho gya hai toh uske posts ko bhi saath mein dlte krna ya phir post rhne dena account deactivate or deleted or user shiw krna 


## 1. Soft Delete vs Hard Delete
- **Soft Delete:** Mark records as deleted (e.g., set `is_deleted = true`). Data remains in the database.
    - Pros: Can recover data, audit trails.
    - Cons: Requires filtering in queries.
- **Hard Delete:** Permanently remove records from storage.
    - Pros: Saves space, no extra filtering.
    - Cons: Data is unrecoverable.

## 2. Deletion in Databases
- Use `DELETE` SQL command for hard delete.
- Use an `is_deleted` or `deleted_at` column for soft delete.
- Add indexes on deletion flags for performance.

## 3. Deletion in File Systems
- Remove file using system calls (e.g., `rm`, `unlink`).
- For soft delete, move files to a "trash" or "recycle bin" folder.

## 4. Deletion in Applications
- Confirm deletion with the user (confirmation dialogs).
- Provide undo/restore options if possible.
- Log deletion actions for audit purposes.

## 5. Handling Dependencies
- Check for foreign key constraints in databases.
- Use cascading deletes carefully.
- For related data, consider orphan removal or manual cleanup.

## 6. Security Considerations
- Ensure only authorized users can delete.
- Prevent accidental or malicious mass deletion.

## 7. Testing Deletion
- Test both soft and hard delete scenarios.
- Verify data integrity after deletion.
- Test edge cases (e.g., deleting non-existent items).

## 8. Example: Soft Delete in SQL


mongoose k andr middleware me jao aur documentation read kro 
query middleare padhegee yahn hu  
### 9. Handling Deletion in Mongoose

- **Soft Delete:**  
    - Add a field like `isDeleted` or `deletedAt` to your schema.
    - Update this field instead of removing the document.
    - Filter queries to exclude soft-deleted documents.
    - Example:
        ```js
        // Schema
        const userSchema = new mongoose.Schema({
            name: String,
            isDeleted: { type: Boolean, default: false }
        });

        // Soft delete
        User.updateOne({ _id: id }, { isDeleted: true });
        ```

- **Hard Delete:**  
    - Use `Model.deleteOne()` or `Model.deleteMany()` to remove documents.
    - Example:
        ```js
        User.deleteOne({ _id: id });
        ```

- **Cascading Deletes:**  
    - Manually delete or soft-delete related documents (e.g., posts, comments).
    - Use middleware (`pre('remove')`) for cleanup.

- **Plugins:**  
    - Use plugins like `mongoose-delete` for built-in soft delete support.

- **Best Practices:**  
    - Always filter out soft-deleted documents in queries.
    - Log deletion actions for audit.
    - Test both soft and hard delete flows.